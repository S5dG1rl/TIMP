# Серверная часть приложения

## Обзор

Серверная часть представляет собой многопоточный TCP-сервер, обрабатывающий запросы от клиентов, выполняющий вычислительные задачи и взаимодействующий с базой данных SQLite. Сервер реализован с использованием фреймворка Qt и использует паттерн Singleton для работы с базой данных.

## Структура проекта

```
server/
├── Database.db          # Файл базы данных SQLite
├── database.*           # Класс для работы с БД (реализация паттерна Singleton)
├── tcpserver.*         # Основной класс TCP-сервера
├── functionsforserver.* # Обработка запросов от клиентов
├── dichotomymethod.*    # Реализация метода дихотомии
├── dijkstra.*          # Реализация алгоритма Дейкстры
├── rsa.*               # Криптографические функции (RSA)
├── sha512.*            # Хеширование паролей (SHA-512)
└── main.cpp            # Точка входа в приложение
```

## Архитектура базы данных

### Таблицы

1. **Пользователи**
   - `id` - уникальный идентификатор пользователя (INTEGER PRIMARY KEY)
   - `login` - логин пользователя (TEXT UNIQUE)
   - `password` - хеш пароля (TEXT)
   - `salt` - соль для хеширования (TEXT)
   - `public_key` - открытый ключ пользователя (TEXT)
   - `private_key` - зашифрованный закрытый ключ (TEXT)

2. **Статистика**
   - `id` - уникальный идентификатор записи (INTEGER PRIMARY KEY)
   - `user_id` - ID пользователя (INTEGER, FOREIGN KEY)
   - `task_id` - ID выполненной задачи (INTEGER)
   - `result` - результат выполнения (TEXT)
   - `timestamp` - временная метка выполнения (TEXT)

### Класс DataBase

```cpp
class DataBase {
private:
    static DataBase *p_instance;
    static DatabaseDestroyer destroyer;
    QSqlDatabase db;
    
    // Приватный конструктор и деструктор
    DataBase();
    ~DataBase();
    
public:
    // Получение экземпляра базы данных (Singleton)
    static DataBase& getInstance();
    
    // Основные методы
    bool createTable();
    QSqlDatabase& getDatabase();
    QStringList queryToDatabase(QStringList query);
};
```

## Архитектура сервера

### Основные компоненты

1. **TcpServer**
   - Обработка входящих подключений
   - Чтение/запись данных через сокеты
   - Управление клиентскими соединениями

2. **FunctionsForServer**
   - Разбор входящих JSON-запросов
   - Маршрутизация запросов к соответствующим обработчикам
   - Формирование ответов клиентам

3. **Алгоритмы**
   - `DichotomyMethod` - решение уравнений методом дихотомии
   - `Dijkstra` - поиск кратчайшего пути в графе
   - `RSA` - шифрование/дешифрование данных
   - `SHA512` - хеширование паролей

### Протокол обмена данными

Сервер ожидает JSON-сообщения следующего формата:

```json
{
  "type": "тип_запроса",
  "data": {
    // параметры запроса
  }
}
```

#### Примеры запросов:

1. **Аутентификация**
   ```json
   {
     "type": "auth",
     "data": {
       "login": "user123",
       "password": "hashed_password"
     }
   }
   ```

2. **Регистрация**
   ```json
   {
     "type": "register",
     "data": {
       "login": "new_user",
       "password": "hashed_password",
       "public_key": "..."
     }
   }
   ```

3. **Выполнение задачи**
   ```json
   {
     "type": "task1",
     "data": {
       "param1": "value1",
       "param2": "value2"
     }
   }
   ```

## Алгоритмы

### Метод дихотомии

Реализован в классе `DichotomyMethod`:
- Находит корень уравнения f(x) = 0 на заданном интервале [a, b]
- Параметры: функция, левая граница, правая граница, точность, макс. итераций
- Использует математический парсер для вычисления значений функции

### Алгоритм Дейкстры

Реализован в классе `Dijkstra`:
- Находит кратчайший путь во взвешенном графе
- Поддерживает как направленные, так и ненаправленные графы
- Возвращает последовательность вершин кратчайшего пути

## Безопасность

1. **Хранение паролей**
   - Пароли хранятся в виде хешей с солью (SHA-512)
   - Используется уникальная соль для каждого пользователя

2. **Обмен данными**
   - Криптография на основе RSA
   - Каждый пользователь имеет пару ключей (открытый/закрытый)
   - Закрытые ключи шифруются мастер-ключом сервера

## Сборка и запуск

### Требования
- Qt 5.15 или выше
- SQLite3
- Компилятор C++ с поддержкой C++11

### Сборка

```bash
qmake Server.pro
make
```

### Запуск сервера

```bash
./echoServer
```

## Мониторинг и логирование

Сервер выводит в консоль информацию о:
- Подключении/отключении клиентов
- Ошибках при обработке запросов
- Выполнении задач
- Ошибках работы с базой данных

## Автор

Попрядухин Евгений Романович 241-352
